import{o as E,r as h}from"./index-XfzghrTN.js";const l=h(!1),i=h(!0),d=h(null),n=h(null);function I(){const a=useNotify(),o=()=>{try{multiProjectDAL.switchToProject("operational");const e=multiProjectDAL.firebaseApps.get("operational");if(!e)throw new Error("Firebase app not found for operational project");return getAuth(e)}catch(e){throw console.error("Error getting auth instance:",e),e}},w=e=>{localStorage.setItem("auth_redirect_page",e)},g=()=>{const e=localStorage.getItem("auth_redirect_page");return localStorage.removeItem("auth_redirect_page"),e||"/test/login-ok"},f=()=>new Promise(e=>{try{const t=o(),s=onAuthStateChanged(t,r=>{l.value=!!r,d.value=r,i.value=!1,n.value=null,s(),e(!!r)})}catch(t){console.error("Auth state check error:",t),i.value=!1,n.value=t.message,e(!1)}}),m=async()=>{try{const e=o();if(isSignInWithEmailLink(e,window.location.href)){let t=localStorage.getItem("emailForSignIn");if(t||(t=window.prompt("Please provide your email for confirmation")),t)return await signInWithEmailLink(e,t,window.location.href),localStorage.removeItem("emailForSignIn"),a.success("Successfully signed in!"),!0}return!1}catch(e){return console.error("Passwordless auth setup error:",e),a.error("Authentication error occurred"),!1}},c=e=>{switch(e.code){case"auth/invalid-email":return"Please enter a valid email address.";case"auth/user-not-found":return"No account found with this email address.";case"auth/wrong-password":return"Invalid password. Please try again.";case"auth/too-many-requests":return"Too many failed attempts. Please try again later.";case"auth/network-request-failed":return"Network error. Please check your connection and try again.";case"auth/weak-password":return"Password should be at least 6 characters.";case"auth/email-already-in-use":return"This email is already in use by another account.";case"auth/requires-recent-login":return"Please log out and log in again to perform this action.";case"auth/configuration-not-found":return"Authentication service configuration error.";default:return e.message||"An unexpected error occurred. Please try again."}},y=async(e,t)=>{try{i.value=!0,n.value=null;const s=o(),u=(await signInWithEmailAndPassword(s,e,t)).user;return l.value=!0,d.value=u,a.success("Login successful!"),{success:!0,redirectTo:g()}}catch(s){console.error("Login error:",s);const r=c(s);return n.value=r,a.error(r),{success:!1,error:r}}finally{i.value=!1}},p=async()=>{try{const e=o();return await signOut(e),l.value=!1,d.value=null,n.value=null,localStorage.removeItem("auth_redirect_page"),a.success("Logged out successfully"),{success:!0}}catch(e){console.error("Logout error:",e);const t=c(e);return a.error(t),{success:!1,error:t}}},P=async e=>{try{const t=o();return await sendPasswordResetEmail(t,e),a.success("Password reset email sent! Check your inbox."),{success:!0}}catch(t){console.error("Password reset error:",t);const s=c(t);return a.error(s),{success:!1,error:s}}},v=async(e,t)=>{try{const r=o().currentUser;if(!r)throw new Error("No authenticated user found");const u=EmailAuthProvider.credential(r.email,t);return await reauthenticateWithCredential(r,u),await updateEmail(r,e),a.success("Email updated successfully!"),{success:!0}}catch(s){console.error("Email update error:",s);const r=c(s);return a.error(r),{success:!1,error:r}}},A=async(e,t)=>{try{const r=o().currentUser;if(!r)throw new Error("No authenticated user found");const u=EmailAuthProvider.credential(r.email,e);return await reauthenticateWithCredential(r,u),await updatePassword(r,t),a.success("Password updated successfully!"),{success:!0}}catch(s){console.error("Password update error:",s);const r=c(s);return a.error(r),{success:!1,error:r}}};return E(async()=>{await m()||await f()}),{isAuthenticated:l,isLoading:i,currentUser:d,authError:n,storeRedirectPage:w,getAndClearRedirectPage:g,checkAuthState:f,loginUser:y,logoutUser:p,resetPassword:P,updateUserEmail:v,updateUserPassword:A}}export{I as u};

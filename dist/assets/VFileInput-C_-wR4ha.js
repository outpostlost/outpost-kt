import{r as g,g as ue,p as ie,aa as ce,u as de,ab as j,c as f,ac as T,t as pe,s as fe,w as ve,h as ge,V as me,i as y,N as v,F as I,m as R,C as be,K as he,ad as ye}from"./index-XfzghrTN.js";import{u as De,V as N,a as $,b as Se,f as we,c as Fe,m as Ce}from"./forwardRefs--s6B5EbG.js";import{V as Ie}from"./VChip-CdDlcFnE.js";class Re{async uploadFile(t,n){console.log("=== SERVICE METHOD DEBUG ==="),console.log("Service Method Debug - this context:",this),console.log("Service Method Debug - arguments.length:",arguments.length),console.log("Service Method Debug - Received file parameter:",t),console.log("Service Method Debug - File type:",typeof t),console.log("Service Method Debug - File size:",t==null?void 0:t.size),console.log("Service Method Debug - File name:",t==null?void 0:t.name),console.log("Service Method Debug - Received metadata parameter:",n),console.log("Service Method Debug - Starting upload process...");try{await multiProjectDAL.switchToProject("operational"),console.log("Service Debug - Switched to operational project");const i=`/api/blob-upload?filename=${encodeURIComponent(n.fileName)}`;console.log("Service Debug - Upload URL:",i),console.log("Service Debug - About to fetch API...");const a=await fetch(i,{method:"POST",body:t});console.log("Service Debug - Response status:",a.status),console.log("Service Debug - Response ok:",a.ok);const l=await a.json();if(console.log("Service Debug - Response JSON:",l),!l.success)throw new Error(l.message||"Blob upload failed");const s={fileName:n.fileName,description:n.description,source:n.source,notes:n.notes?[n.notes]:[],url:l.blobUrl,fileSize:t.size,fileType:t.type,uploadStatus:"successful",uploadType:"new"};console.log("Service Debug - About to store metadata:",s);const r=await multiProjectDAL.addItem("dataUploads",s);return console.log(`Upload complete - Blob: ${l.blobUrl}, Document: ${r}`),{success:!0,blobUrl:l.blobUrl,documentId:r,fileSize:t.size,fileType:t.type}}catch(i){console.error("Service Debug - Error caught:",i);try{const a={fileName:n.fileName,description:n.description||"",source:n.source||"",notes:n.notes?[n.notes]:[],url:"",fileSize:(t==null?void 0:t.size)||0,fileType:(t==null?void 0:t.type)||"",uploadStatus:"failure",uploadType:"new"};console.log("Service Debug - Storing failure metadata:",a),await multiProjectDAL.addItem("dataUploads",a)}catch(a){console.error("Service Debug - Failed to store failure metadata:",a)}throw i}}}const ke=new Re;function Ee(){const e=g(!1),t=g(null),n=g(null);return{isUploading:e,uploadResult:t,uploadError:n,uploadFile:async(l,s)=>{console.log("=== COMPOSABLE DEBUG ==="),console.log("Composable Debug - Received file:",l),console.log("Composable Debug - File type:",typeof l),console.log("Composable Debug - File size:",l==null?void 0:l.size),console.log("Composable Debug - File name:",l==null?void 0:l.name),console.log("Composable Debug - Received metadata:",s),console.log("Composable Debug - About to call blobUploadService.uploadFile..."),e.value=!0,t.value=null,n.value=null;try{const r=await ke.uploadFile(l,s);return t.value=r,r}catch(r){throw n.value=r.message,r}finally{e.value=!1}},resetUpload:()=>{t.value=null,n.value=null}}}function Pe(){function e(n){var a,l;return[...((a=n.dataTransfer)==null?void 0:a.items)??[]].filter(s=>s.kind==="file").map(s=>s.webkitGetAsEntry()).filter(Boolean).length>0||[...((l=n.dataTransfer)==null?void 0:l.files)??[]].length>0}async function t(n){var l,s;const i=[],a=[...((l=n.dataTransfer)==null?void 0:l.items)??[]].filter(r=>r.kind==="file").map(r=>r.webkitGetAsEntry()).filter(Boolean);if(a.length)for(const r of a){const D=await O(r,L(".",r));i.push(...D.map(S=>S.file))}else i.push(...((s=n.dataTransfer)==null?void 0:s.files)??[]);return i}return{handleDrop:t,hasFilesOrFolders:e}}function O(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((n,i)=>{e.isFile?e.file(l=>n([{file:l,path:t}]),i):e.isDirectory&&e.createReader().readEntries(async l=>{const s=[];for(const r of l)s.push(...await O(r,L(t,r)));n(s)})})}function L(e,t){return t.isDirectory?`${e}/${t.name}`:e}const Ve=ie({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...Ce({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>j(e).every(t=>t!=null&&typeof t=="object")},...Fe({clearable:!0})},"VFileInput"),Me=ue()({name:"VFileInput",inheritAttrs:!1,props:Ve(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:n,emit:i,slots:a}=t;const{t:l}=ce(),s=de(e,"modelValue",e.modelValue,o=>j(o),o=>!e.multiple&&Array.isArray(o)?o[0]:o),{isFocused:r,focus:D,blur:S}=De(e),k=f(()=>typeof e.showSize!="boolean"?e.showSize:void 0),P=f(()=>(s.value??[]).reduce((o,u)=>{let{size:p=0}=u;return o+p},0)),V=f(()=>T(P.value,k.value)),w=f(()=>(s.value??[]).map(o=>{const{name:u="",size:p=0}=o;return e.showSize?`${u} (${T(p,k.value)})`:u})),x=f(()=>{var u;const o=((u=s.value)==null?void 0:u.length)??0;return e.showSize?l(e.counterSizeString,o,V.value):l(e.counterString,o)}),z=g(),A=g(),c=g(),G=pe(()=>r.value||e.active),U=f(()=>["plain","underlined"].includes(e.variant)),b=fe(!1),{handleDrop:H,hasFilesOrFolders:J}=Pe();function F(){var o;c.value!==document.activeElement&&((o=c.value)==null||o.focus()),r.value||D()}function K(o){var u;(u=c.value)==null||u.click()}function _(o){i("mousedown:control",o)}function q(o){var u;(u=c.value)==null||u.click(),i("click:control",o)}function Q(o){o.stopPropagation(),F(),he(()=>{s.value=[],ye(e["onClick:clear"],o)})}function W(o){o.preventDefault(),o.stopImmediatePropagation(),b.value=!0}function X(o){o.preventDefault(),b.value=!1}async function Y(o){if(o.preventDefault(),o.stopImmediatePropagation(),b.value=!1,!c.value||!J(o))return;const u=new DataTransfer;for(const p of await H(o))u.items.add(p);c.value.files=u.files,c.value.dispatchEvent(new Event("change",{bubbles:!0}))}return ve(s,o=>{(!Array.isArray(o)||!o.length)&&c.value&&(c.value.value="")}),ge(()=>{const o=!!(a.counter||e.counter),u=!!(o||a.details),[p,Z]=me(n),{modelValue:ze,...ee}=N.filterProps(e),oe=$.filterProps(e);return y(N,R({ref:z,modelValue:e.multiple?s.value:s.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":b.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":U.value},e.class],style:e.style,"onClick:prepend":K},p,ee,{centerAffix:!U.value,focused:r.value}),{...a,default:C=>{let{id:h,isDisabled:m,isDirty:B,isReadonly:E,isValid:te,hasDetails:le}=C;return y($,R({ref:A,prependIcon:e.prependIcon,onMousedown:_,onClick:q,"onClick:clear":Q,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},oe,{id:h.value,active:G.value||B.value,dirty:B.value||e.dirty,disabled:m.value,focused:r.value,details:le.value,error:te.value===!1,onDragover:W,onDrop:Y}),{...a,default:ne=>{var M;let{props:{class:ae,...se}}=ne;return v(I,null,[v("input",R({ref:c,type:"file",readonly:E.value,disabled:m.value,multiple:e.multiple,name:e.name,onClick:d=>{d.stopPropagation(),E.value&&d.preventDefault(),F()},onChange:d=>{if(!d.target)return;const re=d.target;s.value=[...re.files??[]]},onDragleave:X,onFocus:F,onBlur:S},se,Z),null),v("div",{class:be(ae)},[!!((M=s.value)!=null&&M.length)&&!e.hideInput&&(a.selection?a.selection({fileNames:w.value,totalBytes:P.value,totalBytesReadable:V.value}):e.chips?w.value.map(d=>y(Ie,{key:d,size:"small",text:d},null)):w.value.join(", "))])])}})},details:u?C=>{var h,m;return v(I,null,[(h=a.details)==null?void 0:h.call(a,C),o&&v(I,null,[v("span",null,null),y(Se,{active:!!((m=s.value)!=null&&m.length),value:x.value,disabled:e.disabled},a.counter)])])}:void 0})}),we({},z,A,c)}});export{Me as V,Ee as u};

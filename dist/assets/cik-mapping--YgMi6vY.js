import{r as T,Z as F,l as N,c as $,o as j,n as m,q as f,v as e,i as t,C as A,y as h,A as o,X as u,z as s,N as K,x as B,F as z,R as H}from"./index-XfzghrTN.js";import U from"./useNotify-CNR52NHZ.js";import{u as q}from"./useAuth-CpsKkO3P.js";import{b as M}from"./route-block-B_A1xBdJ.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as x,a as v,b as y,c as V,d as S}from"./VCard-BECKUIfU.js";import{V as X}from"./VContainer-R6qPkMgO.js";import{V as Z}from"./VBtn-DyMKmmJZ.js";import{V as D}from"./VAlert-BXOlNWtC.js";import{j as J}from"./VAvatar-DrNrBBh9.js";import{V as Q,a as w,c as P}from"./VList-uSYSyOiG.js";import{V as W}from"./VChip-CdDlcFnE.js";import{V as Y}from"./VDataTable-ClKBkycv.js";import{V as ee,a as te,b as ae,c as se}from"./VExpansionPanels-Cmix9OAe.js";import{V as re}from"./VSheet-Braltggs.js";import"./dimensions-BTn1Zqj3.js";import"./index-CT5Z8H4E.js";import"./ssrBoot-CEib-DlM.js";import"./VSelect-7OPIFvbh.js";import"./VTextField-DrQV8GZt.js";import"./forwardRefs--s6B5EbG.js";import"./VOverlay-CuvIps3-.js";import"./scopeId-JKcj2l0q.js";import"./lazy-CW5rMfy1.js";import"./VSelectionControl-CgJ3t_n0.js";function oe(){const E=U(),g=T(!1),n=T({total:0,processed:0,matched:0,updated:0,errors:0}),C=T([]),i=T([]);async function c(){if(g.value){E.warning("CIK update process is already running");return}g.value=!0,n.value={total:0,processed:0,matched:0,updated:0,errors:0},C.value=[],i.value=[];try{E.info("Starting CIK update process..."),console.log("=== CIK UPDATE PROCESS STARTED ==="),console.log("Fetching SEC company tickers data via serverless function...");const a=await b();console.log(`SEC ticker mapping loaded: ${Object.keys(a).length} companies`),console.log("Retrieving existing company records from Firestore...");const d=await multiProjectDAL.getAllItems("dataFiliteredCompanyList");n.value.total=d.length,console.log(`Found ${d.length} existing company records`),console.log("Starting company processing...");for(const r of d)await I(r,a),n.value.processed++;const p={total:n.value.total,matched:n.value.matched,updated:n.value.updated,skipped:C.value.length,errors:n.value.errors};console.log("=== CIK UPDATE PROCESS COMPLETED ==="),console.log("Summary:",p),E.success(`CIK update completed! ${p.updated} companies updated, ${p.skipped} skipped`)}catch(a){console.error("CIK Update Process Error:",a),i.value.push({stage:"Main Process",error:a.message,timestamp:new Date().toISOString()}),E.error(`CIK update failed: ${a.message}`)}finally{g.value=!1}}async function b(){try{console.log("Calling serverless function: /api/sec-tickers");const a=await fetch("/api/sec-tickers");if(!a.ok)throw new Error(`Serverless function failed: ${a.status} ${a.statusText}`);const d=await a.json();if(!d.success)throw new Error(`SEC data fetch failed: ${d.error}`);console.log(`Serverless function returned ${d.count} companies at ${d.timestamp}`);const p={};return Object.values(d.data).forEach(r=>{r.ticker&&r.cik_str&&(p[r.ticker.toUpperCase()]={cik:r.cik_str,title:r.title})}),console.log(`Processed ticker mapping: ${Object.keys(p).length} valid entries`),p}catch(a){throw console.error("Error fetching SEC ticker mapping via serverless function:",a),new Error(`Failed to fetch SEC data: ${a.message}`)}}async function I(a,d){var p;try{const r=(p=a.Ticker)==null?void 0:p.toUpperCase();if(!r){console.warn(`Company ${a.Company} has no ticker symbol`),C.value.push({company:a.Company,reason:"No ticker symbol",id:a.id});return}if(a.cik){console.log(`Company ${r} already has CIK: ${a.cik}`),n.value.matched++;return}const _=d[r];if(_){n.value.matched++;const L={cik:_.cik,secTitle:_.title,cikUpdatedAt:new Date().toISOString()};await multiProjectDAL.updateItem("dataFiliteredCompanyList",a.id,L),n.value.updated++,console.log(`Updated ${r} with CIK: ${_.cik}`)}else C.value.push({company:a.Company,ticker:r,reason:"Not found in SEC data",id:a.id})}catch(r){console.error(`Error processing company ${a.Company}:`,r),n.value.errors++,i.value.push({company:a.Company,ticker:a.Ticker,error:r.message,timestamp:new Date().toISOString()})}}return{isProcessing:g,progress:n,skippedCompanies:C,errorLog:i,updateAllCIKs:c}}const le="CIK Mapping",O={__name:"cik-mapping",setup(E){F(),U();const g=N(),n=$(()=>g.current.value.dark?"bg-charcoal":"bg-parchment"),C=$(()=>g.current.value.dark?"text-stone-gray":"text-secondary");q();const{isProcessing:i,progress:c,skippedCompanies:b,errorLog:I,updateAllCIKs:a}=oe(),d=$(()=>c.value.total===0?0:c.value.processed/c.value.total*100),p=[{title:"Company",value:"company",sortable:!0},{title:"Ticker",value:"ticker",sortable:!0},{title:"Reason",value:"reason",sortable:!1},{title:"Record ID",value:"id",sortable:!1}],r={title:"CIK Mapping - Outpost KT"};async function _(){console.log("User initiated CIK update process"),await a()}return j(()=>{document.title=r.title}),(L,l)=>(f(),m(re,{class:"flex-grow-1 d-flex flex-column",flat:"",rounded:"",color:"surface"},{default:e(()=>[t(x,{class:"flex-grow-1 ma-0"},{default:e(()=>[t(v,{class:"d-flex flex-column pa-0"},{default:e(()=>[t(y,{class:A(["flex-grow-1","d-flex","flex-column",n.value]),flat:"",border:0},{default:e(()=>[t(V,{class:"flex-grow-1",style:{"overflow-y":"auto"},border:0},{default:e(()=>[t(X,{fluid:""},{default:e(()=>[t(x,null,{default:e(()=>[t(v,{cols:"2"},{default:e(()=>[t(y,{variant:"text",class:A([C.value,"text-h5",n.value]),border:0},{default:e(()=>[o(u(le||"Loading..."),1)]),_:1},8,["class"])]),_:1})]),_:1}),t(x,null,{default:e(()=>[t(v,{cols:"12"},{default:e(()=>[t(y,{class:"bg-surface",variant:"outlined"},{default:e(()=>[t(S,{class:"text-secondary"},{default:e(()=>[...l[0]||(l[0]=[o("CIK Update Process",-1)])]),_:1}),t(V,null,{default:e(()=>[t(Z,{color:"primary",size:"large",loading:s(i),disabled:s(i),onClick:_},{default:e(()=>[o(u(s(i)?"Processing...":"Start CIK Update Process"),1)]),_:1},8,["loading","disabled"]),s(i)?(f(),m(D,{key:0,type:"info",class:"mt-4"},{default:e(()=>[...l[1]||(l[1]=[o(" Processing company records... This may take several minutes. ",-1)])]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),s(i)||s(c).total>0?(f(),m(x,{key:0},{default:e(()=>[t(v,{cols:"6"},{default:e(()=>[t(y,{class:"bg-surface",variant:"outlined"},{default:e(()=>[t(S,{class:"text-secondary"},{default:e(()=>[...l[2]||(l[2]=[o("Progress",-1)])]),_:1}),t(V,null,{default:e(()=>[t(J,{"model-value":d.value,height:"20",color:"primary",class:"mb-4"},{default:e(({value:k})=>[K("strong",null,u(Math.ceil(k))+"%",1)]),_:1},8,["model-value"]),t(Q,{density:"compact"},{default:e(()=>[t(w,null,{default:e(()=>[t(P,null,{default:e(()=>[o("Total Companies: "+u(s(c).total),1)]),_:1})]),_:1}),t(w,null,{default:e(()=>[t(P,null,{default:e(()=>[o("Processed: "+u(s(c).processed),1)]),_:1})]),_:1}),t(w,null,{default:e(()=>[t(P,null,{default:e(()=>[o("Matched: "+u(s(c).matched),1)]),_:1})]),_:1}),t(w,null,{default:e(()=>[t(P,null,{default:e(()=>[o("Updated: "+u(s(c).updated),1)]),_:1})]),_:1}),s(c).errors>0?(f(),m(w,{key:0},{default:e(()=>[t(P,{class:"text-error"},{default:e(()=>[o("Errors: "+u(s(c).errors),1)]),_:1})]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(v,{cols:"6"},{default:e(()=>[t(y,{class:"bg-surface",variant:"outlined"},{default:e(()=>[t(S,{class:"text-secondary"},{default:e(()=>[...l[3]||(l[3]=[o("Current Status",-1)])]),_:1}),t(V,null,{default:e(()=>[t(W,{color:s(i)?"orange":"green",variant:"flat",size:"large"},{default:e(()=>[o(u(s(i)?"In Progress":"Completed"),1)]),_:1},8,["color"]),!s(i)&&s(c).total>0?(f(),m(D,{key:0,type:"success",class:"mt-4"},{default:e(()=>[...l[4]||(l[4]=[o(" Process completed! Check results below. ",-1)])]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),!s(i)&&s(b).length>0?(f(),m(x,{key:1},{default:e(()=>[t(v,{cols:"12"},{default:e(()=>[t(y,{class:"bg-surface",variant:"outlined"},{default:e(()=>[t(S,{class:"text-secondary"},{default:e(()=>[o(" Skipped Companies ("+u(s(b).length)+") ",1)]),_:1}),t(V,null,{default:e(()=>[t(Y,{headers:p,items:s(b),density:"compact","items-per-page":10},null,8,["items"])]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),!s(i)&&s(I).length>0?(f(),m(x,{key:2},{default:e(()=>[t(v,{cols:"12"},{default:e(()=>[t(y,{class:"bg-surface",variant:"outlined"},{default:e(()=>[t(S,{class:"text-error"},{default:e(()=>[o(" Errors ("+u(s(I).length)+") ",1)]),_:1}),t(V,null,{default:e(()=>[t(ee,null,{default:e(()=>[(f(!0),B(z,null,H(s(I),(k,R)=>(f(),m(te,{key:R},{default:e(()=>[t(ae,null,{default:e(()=>[o(u(k.company||k.stage)+" - "+u(k.ticker),1)]),_:2},1024),t(se,null,{default:e(()=>[t(D,{type:"error",variant:"outlined"},{default:e(()=>[l[5]||(l[5]=K("strong",null,"Error:",-1)),o(" "+u(k.error),1),l[6]||(l[6]=K("br",null,null,-1)),l[7]||(l[7]=K("strong",null,"Time:",-1)),o(" "+u(k.timestamp),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}))}};typeof M=="function"&&M(O);const $e=G(O,[["__scopeId","data-v-14e5ea1e"]]);export{$e as default};

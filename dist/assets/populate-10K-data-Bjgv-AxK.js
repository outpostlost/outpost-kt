import{Z,l as J,r as i,c as y,o as Q,n as b,q as V,v as e,i as l,C as E,A as s,X as r,y as K,N as c}from"./index-XfzghrTN.js";import Y from"./useNotify-CNR52NHZ.js";import{u as ee}from"./useAuth-CpsKkO3P.js";import{u as le}from"./useEdgarTenK-CwKF01ya.js";import{b as S}from"./route-block-B_A1xBdJ.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as n,a as o,b as m,c as w,d as N}from"./VCard-BECKUIfU.js";import{V as ae}from"./VContainer-R6qPkMgO.js";import{V as $}from"./VBtn-DyMKmmJZ.js";import{j as B}from"./VAvatar-DrNrBBh9.js";import{V as se}from"./VAlert-BXOlNWtC.js";import{V as oe}from"./VDataTable-ClKBkycv.js";import{V as re}from"./VSheet-Braltggs.js";import"./dimensions-BTn1Zqj3.js";import"./VSelect-7OPIFvbh.js";import"./VTextField-DrQV8GZt.js";import"./forwardRefs--s6B5EbG.js";import"./index-CT5Z8H4E.js";import"./VList-uSYSyOiG.js";import"./ssrBoot-CEib-DlM.js";import"./VOverlay-CuvIps3-.js";import"./scopeId-JKcj2l0q.js";import"./lazy-CW5rMfy1.js";import"./VSelectionControl-CgJ3t_n0.js";import"./VChip-CdDlcFnE.js";const ne="Populate 10-K Data",M={__name:"populate-10K-data",setup(ue){Z();const v=Y(),R=J(),_=i(!1),f=i(!1),A=i(!1),L=i(!1),T=i([]),p=i([]),g=i([]),D=i(null),C=i(0),k=i(0),P=i(0),{fetchTenKReports:F}=le(),j=[{title:"Company",key:"Company",sortable:!0},{title:"Ticker",key:"Ticker",sortable:!0},{title:"Description",key:"Description",sortable:!1},{title:"Document ID",key:"id",sortable:!1}],h=y(()=>R.current.value.dark?"bg-charcoal":"bg-parchment"),H=y(()=>R.current.value.dark?"text-stone-gray":"text-secondary"),W=y(()=>T.value.length),q=y(()=>T.value.filter(a=>a.tenKReports&&a.tenKReports.length>0).length),x=y(()=>p.value.length),I=y(()=>x.value===0?0:C.value/x.value*100);ee();const z={title:"Populate 10-K Data"},G=async()=>{_.value=!0,T.value=[],p.value=[],g.value=[],L.value=!1;try{const a=await multiProjectDAL.getAllItems("dataFiliteredCompanyList",[],"operational");T.value=a;const t=[],d=[];a.forEach(u=>{!u.cik||u.cik===null||u.cik===void 0?d.push(u):t.push(u)}),g.value=d,p.value=t.filter(u=>!u.tenKReports||u.tenKReports.length===0),L.value=!0,v.success(`Loaded ${a.length} companies. ${p.value.length} need processing.`)}catch(a){console.error("Error loading companies:",a),v.error(`Error loading companies: ${a.message}`)}finally{_.value=!1}},O=a=>new Promise(t=>setTimeout(t,a)),U=async()=>{if(p.value.length===0){v.info("No companies need processing");return}f.value=!0,A.value=!1,C.value=0,k.value=0,P.value=0;try{for(let a=0;a<p.value.length&&f.value;a++){const t=p.value[a];D.value=t;try{const d=await F(t.cik);await multiProjectDAL.updateItem("dataFiliteredCompanyList",t.id,{tenKReports:d,tenKReportsUpdatedAt:new Date().toISOString()},"operational"),k.value++,console.log(`✓ Processed ${t.Company} (${t.Ticker}) - ${d.length} reports`)}catch(d){P.value++,console.error(`✗ Failed to process ${t.Company} (${t.Ticker}):`,d)}C.value++,a<p.value.length-1&&await O(111)}A.value=!0,v.success(`Processing complete! ${k.value} successful, ${P.value} failed.`)}catch(a){console.error("Error during bulk processing:",a),v.error(`Processing error: ${a.message}`)}finally{f.value=!1,D.value=null}},X=()=>{f.value=!1,v.info("Processing stopped by user")};return Q(()=>{document.title=z.title}),(a,t)=>(V(),b(re,{class:"flex-grow-1 d-flex flex-column",flat:"",rounded:"",color:"surface"},{default:e(()=>[l(n,{class:"flex-grow-1 ma-0"},{default:e(()=>[l(o,{class:"d-flex flex-column pa-0"},{default:e(()=>[l(m,{class:E(["flex-grow-1","d-flex","flex-column",h.value]),flat:"",border:0},{default:e(()=>[l(w,{class:"flex-grow-1",style:{"overflow-y":"auto"},border:0},{default:e(()=>[l(ae,{fluid:""},{default:e(()=>[l(n,null,{default:e(()=>[l(o,{cols:"2"},{default:e(()=>[l(m,{variant:"text",class:E([H.value,"text-h5",h.value]),border:0},{default:e(()=>[s(r(ne||"Loading..."),1)]),_:1},8,["class"])]),_:1})]),_:1}),l(n,null,{default:e(()=>[l(o,{cols:"12"},{default:e(()=>[l(m,{class:"bg-surface",variant:"outlined"},{default:e(()=>[l(N,{class:"text-secondary"},{default:e(()=>[...t[0]||(t[0]=[s("Bulk 10-K Data Population",-1)])]),_:1}),l(w,null,{default:e(()=>[l(n,null,{default:e(()=>[l(o,{cols:"12"},{default:e(()=>[l(m,{variant:"flat",class:"bg-info-lighten-4 pa-4"},{default:e(()=>[l(n,null,{default:e(()=>[l(o,{cols:"3"},{default:e(()=>[t[1]||(t[1]=c("strong",null,"Total Companies:",-1)),s(" "+r(W.value),1)]),_:1}),l(o,{cols:"3"},{default:e(()=>[t[2]||(t[2]=c("strong",null,"Need Processing:",-1)),s(" "+r(x.value),1)]),_:1}),l(o,{cols:"3"},{default:e(()=>[t[3]||(t[3]=c("strong",null,"Already Have Data:",-1)),s(" "+r(q.value),1)]),_:1}),l(o,{cols:"3"},{default:e(()=>[t[4]||(t[4]=c("strong",null,"Missing CIK:",-1)),s(" "+r(g.value.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(n,null,{default:e(()=>[l(o,{cols:"12",class:"d-flex gap-2 align-center"},{default:e(()=>[l($,{color:"primary",onClick:G,loading:_.value,disabled:_.value||f.value},{default:e(()=>[...t[5]||(t[5]=[s(" Load Companies ",-1)])]),_:1},8,["loading","disabled"]),l($,{color:"success",onClick:U,disabled:!L.value||f.value||x.value===0},{default:e(()=>[...t[6]||(t[6]=[s(" Start Processing ",-1)])]),_:1},8,["disabled"]),l($,{color:"error",onClick:X,disabled:!f.value},{default:e(()=>[...t[7]||(t[7]=[s(" Stop Processing ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),_.value?(V(),b(n,{key:0},{default:e(()=>[l(o,{cols:"12"},{default:e(()=>[l(B,{indeterminate:"",color:"primary"}),l(m,{variant:"flat",class:"text-center pa-2"},{default:e(()=>[...t[8]||(t[8]=[s("Loading companies...",-1)])]),_:1})]),_:1})]),_:1})):K("",!0),f.value?(V(),b(n,{key:1},{default:e(()=>[l(o,{cols:"12"},{default:e(()=>[l(m,{variant:"outlined",class:"mt-4"},{default:e(()=>[l(N,{class:"text-secondary"},{default:e(()=>[...t[9]||(t[9]=[s("Processing Progress",-1)])]),_:1}),l(w,null,{default:e(()=>[l(n,null,{default:e(()=>[l(o,{cols:"12"},{default:e(()=>{var d,u;return[t[10]||(t[10]=c("strong",null,"Currently Processing:",-1)),s(" "+r(((d=D.value)==null?void 0:d.Company)||"N/A")+" ("+r(((u=D.value)==null?void 0:u.Ticker)||"N/A")+") ",1)]}),_:1})]),_:1}),l(n,null,{default:e(()=>[l(o,{cols:"12"},{default:e(()=>[l(B,{"model-value":I.value,color:"success",height:"20"},{default:e(()=>[s(r(C.value)+" of "+r(x.value)+" ("+r(Math.round(I.value))+"%) ",1)]),_:1},8,["model-value"])]),_:1})]),_:1}),l(n,null,{default:e(()=>[l(o,{cols:"4"},{default:e(()=>[t[11]||(t[11]=c("strong",null,"Processed:",-1)),s(" "+r(C.value),1)]),_:1}),l(o,{cols:"4"},{default:e(()=>[t[12]||(t[12]=c("strong",null,"Successful:",-1)),s(" "+r(k.value),1)]),_:1}),l(o,{cols:"4"},{default:e(()=>[t[13]||(t[13]=c("strong",null,"Failed:",-1)),s(" "+r(P.value),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):K("",!0),A.value?(V(),b(n,{key:2},{default:e(()=>[l(o,{cols:"12"},{default:e(()=>[l(se,{type:"success",variant:"outlined"},{default:e(()=>[t[14]||(t[14]=c("strong",null,"Processing Complete!",-1)),s(" Processed "+r(C.value)+" companies. "+r(k.value)+" successful, "+r(P.value)+" failed. ",1)]),_:1})]),_:1})]),_:1})):K("",!0),g.value.length>0?(V(),b(n,{key:3},{default:e(()=>[l(o,{cols:"12"},{default:e(()=>[l(m,{variant:"outlined",class:"mt-4"},{default:e(()=>[l(N,{class:"text-secondary"},{default:e(()=>[s("Companies Missing CIK ("+r(g.value.length)+")",1)]),_:1}),l(w,null,{default:e(()=>[l(oe,{headers:j,items:g.value,"items-per-page":10,class:"elevation-1"},null,8,["items"])]),_:1})]),_:1})]),_:1})]),_:1})):K("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}))}};typeof S=="function"&&S(M);const he=te(M,[["__scopeId","data-v-f86dac30"]]);export{he as default};

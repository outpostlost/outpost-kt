import{r as y,a0 as j,Z as J,c as K,o as Q,n as Y,q as ee,v as o,i as t,A as m,z as u,X as C}from"./index-XfzghrTN.js";import R from"./useNotify-CNR52NHZ.js";import{u as te}from"./useLayoutStore-D_1iMY-J.js";import{b as P}from"./route-block-B_A1xBdJ.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as E,a as q,b,c as x,d as k,e as L}from"./VCard-BECKUIfU.js";import{V as oe}from"./VContainer-R6qPkMgO.js";import{V as v}from"./VBtn-DyMKmmJZ.js";import{V as le}from"./VDataTable-ClKBkycv.js";import{V as N}from"./VDialog-BmHzJSMr.js";import{V as ae}from"./VForm-D4DxYAg7.js";import{V as A}from"./VTextField-DrQV8GZt.js";import{V as U}from"./VSpacer-DV0-RfCV.js";import{V as ie}from"./VSheet-Braltggs.js";import"./VAvatar-DrNrBBh9.js";import"./dimensions-BTn1Zqj3.js";import"./VSelect-7OPIFvbh.js";import"./forwardRefs--s6B5EbG.js";import"./index-CT5Z8H4E.js";import"./VList-uSYSyOiG.js";import"./ssrBoot-CEib-DlM.js";import"./VOverlay-CuvIps3-.js";import"./scopeId-JKcj2l0q.js";import"./lazy-CW5rMfy1.js";import"./VSelectionControl-CgJ3t_n0.js";import"./VChip-CdDlcFnE.js";function ue(){const c=R(),f=y([]),w=y(!1),p=y(!1),r=j({id:null,title:"",route:"",icon:"",order:null}),a=j({title:"",route:"",icon:"",order:""}),n=async()=>{w.value=!0;try{await multiProjectDAL.switchToProject("operational");const e=await multiProjectDAL.getAllItems("appMenu");f.value=e.sort((s,D)=>s.order-D.order)}catch(e){console.error("Error loading menu items:",e),c.error("Failed to load menu items")}finally{w.value=!1}},I=()=>{r.id=null,r.title="",r.route="",r.icon="",r.order=null,V()},V=()=>{a.title="",a.route="",a.icon="",a.order=""},M=()=>{V();let e=!0;return r.title.trim()||(a.title="Title is required",e=!1),r.route.trim()?r.route.startsWith("/")||(a.route='Route must start with "/"',e=!1):(a.route="Route is required",e=!1),r.icon.trim()?r.icon.startsWith("mdi-")||(a.icon='Icon must be a Material Design Icon (start with "mdi-")',e=!1):(a.icon="Icon is required",e=!1),r.order===null||r.order===""?(a.order="Order is required",e=!1):Number.isInteger(Number(r.order))||(a.order="Order must be a whole number",e=!1),e};return{menuItems:f,loading:w,saving:p,formData:r,errors:a,loadMenuItems:n,clearForm:I,clearErrors:V,validateForm:M,createMenuItem:async()=>{if(!M())return!1;p.value=!0;try{await multiProjectDAL.switchToProject("operational");const e={title:r.title.trim(),route:r.route.trim(),icon:r.icon.trim(),order:Number(r.order)},s=await multiProjectDAL.addItem("appMenu",e);return c.success("Menu item created successfully"),await n(),I(),!0}catch(e){return console.error("Error creating menu item:",e),c.error("Failed to create menu item"),!1}finally{p.value=!1}},updateMenuItem:async()=>{if(!M()||!r.id)return!1;p.value=!0;try{await multiProjectDAL.switchToProject("operational");const e={title:r.title.trim(),route:r.route.trim(),icon:r.icon.trim(),order:Number(r.order)};return await multiProjectDAL.updateItem("appMenu",r.id,e),c.success("Menu item updated successfully"),await n(),I(),!0}catch(e){return console.error("Error updating menu item:",e),c.error("Failed to update menu item"),!1}finally{p.value=!1}},deleteMenuItem:async e=>{if(!e)return!1;try{return await multiProjectDAL.switchToProject("operational"),await multiProjectDAL.deleteDocument("appMenu",e),c.success("Menu item deleted successfully"),await n(),!0}catch(s){return console.error("Error deleting menu item:",s),c.error("Failed to delete menu item"),!1}},loadItemForEdit:e=>{r.id=e.id,r.title=e.title,r.route=e.route,r.icon=e.icon,r.order=e.order,V()}}}const S={__name:"menu",setup(c){J(),R();const f=te(),{menuItems:w,loading:p,saving:r,formData:a,errors:n,loadMenuItems:I,clearForm:V,createMenuItem:M,updateMenuItem:_,deleteMenuItem:F,loadItemForEdit:T}=ue(),g=y(!1),e=y(!1),s=y(null),D=K(()=>!!a.id),O=[{title:"Title",key:"title",sortable:!0},{title:"Route",key:"route",sortable:!0},{title:"Icon",key:"icon",sortable:!0},{title:"Order",key:"order",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],h={title:"Menu Administration"},z=()=>{V(),g.value=!0},B=d=>{T(d),g.value=!0},W=()=>{g.value=!1,V()},$=d=>{s.value=d,e.value=!0},X=()=>{e.value=!1,s.value=null},Z=async()=>{let d=!1;D.value?d=await _():d=await M(),d&&(g.value=!1,f.appMenuItems=[],await f.fetchAppMenu())},G=async()=>{s.value&&await F(s.value.id)&&(e.value=!1,s.value=null,f.appMenuItems=[],await f.fetchAppMenu())};return Q(async()=>{document.title=h.title,await I()}),(d,l)=>(ee(),Y(ie,{class:"flex-grow-1 d-flex flex-column",flat:"",rounded:"",color:"surface"},{default:o(()=>[t(E,{class:"flex-grow-1 ma-0"},{default:o(()=>[t(q,{class:"d-flex flex-column pa-0"},{default:o(()=>[t(b,{class:"bg-sand flex-grow-1 d-flex flex-column",flat:"",border:0},{default:o(()=>[t(x,{class:"flex-grow-1",style:{"overflow-y":"auto"},border:0},{default:o(()=>[t(oe,{fluid:""},{default:o(()=>[t(E,null,{default:o(()=>[t(q,{cols:"12"},{default:o(()=>[t(b,{class:"bg-surface",variant:"outlined"},{default:o(()=>[t(k,{class:"text-secondary"},{default:o(()=>[l[7]||(l[7]=m(" Menu Administration ",-1)),t(v,{color:"primary",onClick:z},{default:o(()=>[...l[6]||(l[6]=[m(" Add Menu Item ",-1)])]),_:1})]),_:1}),t(x,null,{default:o(()=>[t(le,{headers:O,items:u(w),loading:u(p),density:"compact","sort-by":[{key:"order",order:"asc"}]},{"item.actions":o(({item:i})=>[t(v,{icon:"mdi-pencil",size:"small",variant:"text",onClick:H=>B(i)},null,8,["onClick"]),t(v,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:H=>$(i)},null,8,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{modelValue:g.value,"onUpdate:modelValue":l[4]||(l[4]=i=>g.value=i),"max-width":"600px"},{default:o(()=>[t(b,null,{default:o(()=>[t(k,null,{default:o(()=>[m(C(D.value?"Edit Menu Item":"Add Menu Item"),1)]),_:1}),t(x,null,{default:o(()=>[t(ae,{ref:"form"},{default:o(()=>[t(A,{modelValue:u(a).title,"onUpdate:modelValue":l[0]||(l[0]=i=>u(a).title=i),label:"Title","error-messages":u(n).title,required:""},null,8,["modelValue","error-messages"]),t(A,{modelValue:u(a).route,"onUpdate:modelValue":l[1]||(l[1]=i=>u(a).route=i),label:"Route","error-messages":u(n).route,hint:"Must start with '/'",required:""},null,8,["modelValue","error-messages"]),t(A,{modelValue:u(a).icon,"onUpdate:modelValue":l[2]||(l[2]=i=>u(a).icon=i),label:"Icon","error-messages":u(n).icon,hint:"Material Design Icon (e.g., mdi-account)",required:""},null,8,["modelValue","error-messages"]),t(A,{modelValue:u(a).order,"onUpdate:modelValue":l[3]||(l[3]=i=>u(a).order=i),label:"Order",type:"number","error-messages":u(n).order,hint:"Number for menu positioning",required:""},null,8,["modelValue","error-messages"])]),_:1},512)]),_:1}),t(L,null,{default:o(()=>[t(U),t(v,{text:"",onClick:W,disabled:u(r)},{default:o(()=>[...l[8]||(l[8]=[m(" Cancel ",-1)])]),_:1},8,["disabled"]),t(v,{color:"primary",onClick:Z,loading:u(r)},{default:o(()=>[m(C(D.value?"Update":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{modelValue:e.value,"onUpdate:modelValue":l[5]||(l[5]=i=>e.value=i),"max-width":"400px"},{default:o(()=>[t(b,null,{default:o(()=>[t(k,null,{default:o(()=>[...l[9]||(l[9]=[m("Confirm Delete",-1)])]),_:1}),t(x,null,{default:o(()=>{var i;return[m(' Are you sure you want to delete the menu item "'+C((i=s.value)==null?void 0:i.title)+'"? ',1)]}),_:1}),t(L,null,{default:o(()=>[t(U),t(v,{text:"",onClick:X},{default:o(()=>[...l[10]||(l[10]=[m(" Cancel ",-1)])]),_:1}),t(v,{color:"error",onClick:G},{default:o(()=>[...l[11]||(l[11]=[m(" Delete ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};typeof P=="function"&&P(S);const qe=re(S,[["__scopeId","data-v-4263f41d"]]);export{qe as default};
